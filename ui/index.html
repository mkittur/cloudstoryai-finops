<!DOCTYPE html>
<html>
<head>
  <title>CloudStoryAI</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: white;
      padding: 40px;
    }

    h2 {
      font-weight: 400;
      margin-bottom: 25px;
    }

    textarea {
      width: 600px;
      height: 80px;
      padding: 12px;
      border-radius: 8px;
      border: none;
    }

    select, button {
      padding: 10px 18px;
      margin-top: 10px;
      border-radius: 6px;
      border: none;
    }

    button {
      background-color: #ff9900;
      color: white;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.9;
    }

    #summary {
      margin-top: 20px;
      padding: 20px;
      background: rgba(255,255,255,0.08);
      border-radius: 10px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    }

    .section {
      margin-top: 40px;
    }

    /* ================= Executive Cards ================= */

    .cloud-container {
      display: flex;
      gap: 30px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .cloud-card {
      width: 260px;
      height: 150px;
      padding: 20px;
      border-radius: 16px;
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.4);
      transition: transform 0.3s ease;
    }

    .cloud-card:hover {
      transform: translateY(-6px);
    }

    .cloud-card h2 {
      font-size: 18px;
      opacity: 0.8;
      margin: 0;
    }

    .cost {
      font-size: 38px;
      font-weight: bold;
      margin-top: 20px;
    }

    .aws { border-top: 4px solid #ff9900; }
    .azure { border-top: 4px solid #0078d4; }
    .gcp { border-top: 4px solid #ea4335; }

    iframe {
      width: 100%;
      height: 550px;
      border: none;
      margin-top: 25px;
      border-radius: 10px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.4);
    }

    @media (max-width: 900px) {
      textarea {
        width: 100%;
      }

      .cloud-container {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>

<h2>CloudStoryAI â€“ FinOps Intelligence Platform</h2>

<!-- =================== INPUT SECTION =================== -->
<div class="section">
  <textarea id="query" placeholder="Ask about cloud cost..."></textarea><br>

  <select id="persona">
    <option value="cfo">CFO</option>
    <option value="engineering">Engineering</option>
    <option value="finops">FinOps</option>
  </select>

  <button onclick="askAI()">Ask AI</button>
</div>

<!-- =================== AI OUTPUT =================== -->
<div id="summary" class="section"></div>

<audio id="audio" controls style="margin-top:15px;"></audio>

<!-- =================== EXECUTIVE DASHBOARD =================== -->
<div class="section">
  <h3>Executive Dashboard</h3>

  <div class="cloud-container">
    <div class="cloud-card aws">
      <h2>AWS</h2>
      <div class="cost" id="aws">$0</div>
    </div>

    <div class="cloud-card azure">
      <h2>Azure</h2>
      <div class="cost" id="azure">$0</div>
    </div>

    <div class="cloud-card gcp">
      <h2>GCP</h2>
      <div class="cost" id="gcp">$0</div>
    </div>
  </div>

  <!-- Power BI Embed -->
  <iframe 
    title="CloudStoryAI Report"
    src="https://app.powerbi.com/view?r=eyJrIjoiZjE1OTUyMWUtNGMwNC00NGQ5LWFjMGItYjY4NTE3NzgyZGUxIiwidCI6ImY4ZDhjNTRkLTY1MmItNGM2Zi04YzkzLWQ1MWM0Y2NhNDRlNCJ9"
    allowFullScreen="true">
  </iframe>
</div>

<script>
async function loadSummary() {
  const res = await fetch('/finops/cloud-summary');
  const data = await res.json();

  animateValue("aws", data.aws);
  animateValue("azure", data.azure);
  animateValue("gcp", data.gcp);
}

function animateValue(id, newValue) {
  const element = document.getElementById(id);
  const start = parseFloat(element.innerText.replace("$","")) || 0;
  const duration = 800;
  const startTime = performance.now();

  function update(currentTime) {
    const progress = Math.min((currentTime - startTime) / duration, 1);
    const value = start + (newValue - start) * progress;
    element.innerText = "$" + value.toFixed(2);
    if (progress < 1) requestAnimationFrame(update);
  }

  requestAnimationFrame(update);
}

setInterval(loadSummary, 30000);
loadSummary();

function askAI() {
  const q = document.getElementById("query").value;
  const persona = document.getElementById("persona").value;

  fetch("/ai/query", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query: q, persona: persona })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("summary").innerText = data.summary;
    if (data.audio_url) {
      document.getElementById("audio").src = data.audio_url;
    }
  })
  .catch(err => {
    document.getElementById("summary").innerText = "Error calling AI service.";
    console.error(err);
  });
}
</script>

</body>
</html>

