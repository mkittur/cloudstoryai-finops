<!DOCTYPE html>
<html>
<head>
  <title>CloudStoryAI</title>

  <style>
    body { 
      font-family: Arial; 
      margin: 40px; 
      background-color: #f4f6f9;
    }

    h2 { margin-bottom: 20px; }

    textarea { 
      width: 600px; 
      height: 80px; 
      padding: 10px;
    }

    select, button {
      padding: 8px 15px;
      margin-top: 10px;
    }

    #summary { 
      margin-top: 20px; 
      padding: 15px; 
      background: white; 
      border-radius: 6px;
      box-shadow: 0px 2px 6px rgba(0,0,0,0.1);
    }

    iframe { 
      width: 100%; 
      height: 550px; 
      border: none; 
      margin-top: 25px; 
      border-radius: 6px;
      box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
    }

    .section {
      margin-top: 30px;
    }
  </style>
</head>

<body>

<h2>CloudStoryAI â€“ FinOps Intelligence Platform</h2>

<!-- =================== INPUT SECTION =================== -->
<div class="section">
  <textarea id="query" placeholder="Ask about cloud cost..."></textarea><br>

  <select id="persona">
    <option value="cfo">CFO</option>
    <option value="engineering">Engineering</option>
    <option value="finops">FinOps</option>
  </select>

  <button onclick="askAI()">Ask AI</button>
</div>

<!-- =================== AI OUTPUT =================== -->
<div id="summary" class="section"></div>

<audio id="audio" controls style="margin-top:15px;"></audio>

<!-- =================== POWER BI EMBED =================== -->
<div class="section">
  <h3>Executive Dashboard</h3>


  <div class="cloud-container">
  <div class="cloud-card aws">
      <h2>AWS</h2>
      <div class="cost" id="aws">$0</div>
  </div>

  <div class="cloud-card azure">
      <h2>Azure</h2>
      <div class="cost" id="azure">$0</div>
  </div>

  <div class="cloud-card gcp">
      <h2>GCP</h2>
      <div class="cost" id="gcp">$0</div>
  </div>
</div>

<script>
async function loadSummary() {
    const res = await fetch('/finops/cloud-summary');
    const data = await res.json();

    document.getElementById("aws").innerText = "$" + data.aws.toFixed(2);
    document.getElementById("azure").innerText = "$" + data.azure.toFixed(2);
    document.getElementById("gcp").innerText = "$" + data.gcp.toFixed(2);
}

setInterval(loadSummary, 30000);
loadSummary();
</script>

  <!-- Replace this URL with your Power BI embed lin-->
  <iframe title="TestCloudStoryAI" width="600" height="373.5" src="https://app.powerbi.com/view?r=eyJrIjoiZjE1OTUyMWUtNGMwNC00NGQ5LWFjMGItYjY4NTE3NzgyZGUxIiwidCI6ImY4ZDhjNTRkLTY1MmItNGM2Zi04YzkzLWQ1MWM0Y2NhNDRlNCJ9" frameborder="0" allowFullScreen="true"></iframe>>
</div>

<script>
function askAI() {
  const q = document.getElementById("query").value;
  const persona = document.getElementById("persona").value;

  fetch("/ai/query", {   // relative path (important)
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query: q, persona: persona })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("summary").innerText = data.summary;

    if (data.audio_url) {
      document.getElementById("audio").src = data.audio_url;
    }
  })
  .catch(err => {
    document.getElementById("summary").innerText = "Error calling AI service.";
    console.error(err);
  });
}
</script>

</body>
</html>

